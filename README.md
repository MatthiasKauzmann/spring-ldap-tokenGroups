# Get the Active Directory attribute ```tokenGroups``` in an easy fashion

Recently at work I had to deal with Active Directory's (AD) attribute ```tokenGroups```. That's a really tricky one.
You might have already found out about that. It's kind of invisible, meaning one can not display it in - let's say - a client like the 
Active Directory Explorer. That's b/c it's a so-called ```extended property```, which is only being generated by the AD when
explicitly requested for. Therefore regular queries - like for all objects related to a user f.e. - will not show it. The AD filter 
syntax doesn't even support it as a filter attribute.

In the Java world one does not need to write LDAP syntax since frameworks like Spring LDAP - namely the LdapTemplate class -
provide many methods that translate into AD queries. Still, asking for that one specific attribute comes with a burden. The attribute 
tokenGroups is a list of byte arrays. It contains the ```objectSid``` of every direct and indirect (transient) authority/membership an user 
or group has. So if I was a member of 20 groups in my workplace my ```memberOf``` attribute in AD would have a count of 20. 
But if these groups were also members in some other groups - let's say in 10 - I'd have a total count of 30 (adding my indirect/transient 
memberships). This piece of information is hard to get! Trust me. 

A naive approach would be to gather transient memberships by recursion. You would start with fetching an user's memberOf-attribute, which 
returns a list of the distinguished names of the memberships. A ```distinguished name``` is the best filter one can provide for a LDAP 
search b/c it's the complete path, which is the fastest route to resources in hierarchical databases like AD.    


A request to LDAP comes with a short living properties cache 
